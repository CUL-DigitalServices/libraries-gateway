<!-- Page header -->
<div class="campl-row campl-page-header">
  <div class="campl-wrap clearfix">
    <div class="campl-column12">
      <div class="campl-content-container">
        <div class="campl-breadcrumb" id="breadcrumb">
          <ul class="campl-unstyled-list campl-horizontal-navigation clearfix">
            <li class='first-child'>
              <a href="/" class="campl-home ir">Home</a>
            </li>
            <li>
              <a href="/"><%= title %></a>
            </li>
            <li>
              <p class="campl-current"><%= currentNode.title %></p>
            </li>
          </ul>
        </div>
        <h1 class="campl-page-title"><%= title %></h1>
      </div>
    </div>
  </div>
</div>

<div class="campl-row campl-page-header">
  <div class="campl-wrap clearfix campl-local-navigation" id="local-nav">
    <%- partials.navigation %>
  </div>

  <div class="campl-wrap clearfix campl-page-sub-title campl-recessed-sub-title">
    <div class="campl-content-container">
      <h2 class="campl-sub-title">Search results</h2>
    </div>
  </div>
</div>
<!-- page-header ends -->

<div class="campl-row campl-content campl-recessed-content">
  <div class="campl-wrap clearfix">

    <div class="campl-column9">
      <form class="campl-content-container campl-inpage-search-container">
        <%- data.tplSearch %>
      </form>

      <div class="campl-top-padding">
        <ul class="campl-nav campl-nav-tabs campl-nav">
          <li<% if (!data.search.query.api || data.search.query.api === 'aquabrowser') { %> class="active"<% } %>>
            <a href="<% if (data.search.query.q) { %>/find-a-resource?q=<%= data.search.query.q %>&api=aquabrowser<% } %>">Books & Journals (<%= data.search.results.aquabrowser.rowCount || 0 %> results)</a>
          </li>
          <li<% if (data.search.query.api === 'summon') { %> class="active"<% } %>>
            <a href="<% if (data.search.query.q) { %>/find-a-resource?q=<%= data.search.query.q %>&api=summon<% } %>">Articles (<%= data.search.results.summon.rowCount || 0 %> results)</a>
          </li>
        </ul>
      </div>

      <% if (!data.search.query.api || data.search.query.api === 'aquabrowser') { %>

        <!-- Facets overview start -->
        <% if (data.search.results.aquabrowser.facetsOverview.length) { %>
          <div class="campl-column12">
            <div class="campl-content-container">
              <p class="lg-active-facets">
                Refining by:
                <% for (facetIndex in data.search.results.aquabrowser.facetsOverview) { %>
                  <span class="lg-active-facet">
                    <%= data.search.results.aquabrowser.facetsOverview[facetIndex].label %>
                    <a href="?<%= data.search.results.aquabrowser.facetsOverview[facetIndex].url %>" title="Remove filter">(x)</a>
                  </span>
                <% }%>
              </p>
            </div>
          </div>
        <% } %>

        <!-- Facets start -->
        <% if (data.search.results.aquabrowser.rowCount > 0) { %>
          <div class="campl-column3">
            <div class="campl-tertiary-navigation lg-results-facets">
              <div id="aquabrowser-facets" class="campl-tertiary-navigation-structure">

                <!-- Loop start -->
                <% if (data.search.results.aquabrowser.facets) { %>
                  <% for (facetType in data.search.results.aquabrowser.facets) { %>
                    <% var facet = data.search.results.aquabrowser.facets[facetType]; %>
                    <ul class="campl-unstyled-list campl-vertical-breadcrumb">
                      <li>
                        <a href="#facet-aquabrowser-<%= facet.label %>" data-toggle="collapse" data-parent="#aquabrowser-facets"><%= facet.label %>
                          <span class="campl-vertical-breadcrumb-indicator"></span>
                        </a>
                      </li>
                    </ul>
                    <div id="facet-aquabrowser-<%= facet.label %>" class="in">
                      <ul class="campl-unstyled-list campl-vertical-breadcrumb-navigation">
                        <li class="campl-selected">
                          <ul class='campl-unstyled-list campl-vertical-breadcrumb-children'>
                            <% for (facetValue in facet.facets) { %>
                              <li>
                                <a href="/find-a-resource?<%= facet.facets[facetValue].url %>">
                                  <%= facet.facets[facetValue].label %>
                                  (<%= facet.facets[facetValue].numItems %>)
                                </a>
                              </li>
                            <% } %>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  <% } %>
                <% } %>
                <!-- Loop end -->

              </div>
            </div>
          </div>
        <% } %>
        <!-- Facets end -->

        <!-- Resources start -->
        <div<% if (data.search.results.aquabrowser && data.search.results.aquabrowser.rowCount > 0) { %> class="campl-column9"<% } %>>
          <% if (data.search.results.aquabrowser) { %>
            <% if (data.search.results.aquabrowser.rowCount > 0) { %>
              <% for (record in data.search.results.aquabrowser.items) { %>
                <article class="lg-search-result campl-listing-item campl-search-listing clearfix">
                  <div class="campl-column2">
                    <div class="lg-resource-img">
                      <% if (data.search.results.aquabrowser.items[record].thumbnail) { %>
                        <a href="/find-a-resource/aquabrowser/<%= data.search.results.aquabrowser.items[record].id[0] %>">
                          <img class="campl-scale-with-grid" src="<%= data.search.results.aquabrowser.items[record].thumbnail[0] %>" alt="<%= data.search.results.aquabrowser.items[record].title %>">
                        </a>
                      <% } %>
                    </div>
                  </div>
                  <div class="campl-column10">
                    <div class="campl-content-container campl-listing-txt">
                      <header>
                        <h3 class="campl-listing-title">
                          <a href="/find-a-resource/aquabrowser/<%= data.search.results.aquabrowser.items[record].id[0] %>"><%= data.search.results.aquabrowser.items[record].title %></a>
                        </h3>
                      </header>
                      <ul class="lg-resource-properties">
                        <% if (data.search.results.aquabrowser.items[record].author) { %>
                          <li>
                            <h4>Author(s)</h4>
                            <ul>
                              <% for (author in data.search.results.aquabrowser.items[record].author) { %>
                                <li><%= data.search.results.aquabrowser.items[record].author[author] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                        <% if (data.search.results.aquabrowser.items[record].date) { %>
                          <li>
                            <h4>Published</h4>
                            <ul>
                              <% for (date in data.search.results.aquabrowser.items[record].date) { %>
                                <li><%= data.search.results.aquabrowser.items[record].date[date] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                        <% if (data.search.results.aquabrowser.items[record].isbn) { %>
                          <li>
                            <h4>ISBN</h4>
                            <ul>
                              <% for (isbn in data.search.results.aquabrowser.items[record].isbn) { %>
                                <li><%= data.search.results.aquabrowser.items[record].isbn[isbn] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                        <% if (data.search.results.aquabrowser.items[record].src === 'dspace') { %>
                          <li>
                            <h4>Published by:</h4>
                            <ul>
                              <li>University of Cambridge Academic Repository</li>
                            </ul>
                          </li>
                        <% } %>
                      </ul>
                    </div>
                  </div>
                </article>
              <% } %>

              <!-- Pagination start -->
              <% if (data.search.results.aquabrowser.pagination.pageCount) { %>
                <div class="campl-pagination campl-pagination-centered">
                  <ul>
                    <% if (data.search.results.aquabrowser.pagination.previousPage.visible) { %>
                      <li class="campl-previous-li">
                        <a href="/find-a-resource?<%= data.search.results.aquabrowser.pagination.previousPage.url %>" class="ir campl-pagination-btn campl-previous"><span class="campl-arrow-span"></span>previous</a>
                      </li>
                    <% } %>
                    <% for (page in data.search.results.aquabrowser.pagination.pageRange) { %>

                      <% if (data.search.results.aquabrowser.pagination.pageRange[page].type === 'page') { %>
                        <li <% if (data.search.results.aquabrowser.pagination.pageRange[page].number === data.search.results.aquabrowser.pagination.pageNumber) { %>class="campl-active"<% } %>>
                          <a href="/find-a-resource?<%= data.search.results.aquabrowser.pagination.pageRange[page].url %>"><%= data.search.results.aquabrowser.pagination.pageRange[page].number %></a>
                        </li>
                      <% } else { %>
                        <li>
                          <span class="campl-elipsis">...</span>
                        </li>
                      <% } %>
                    <% } %>
                    <% if (data.search.results.aquabrowser.pagination.nextPage.visible) { %>
                      <li class="campl-next-li">
                        <a href="/find-a-resource?<%= data.search.results.aquabrowser.pagination.nextPage.url %>" class="ir campl-pagination-btn campl-next"><span class="campl-arrow-span"></span>next</a>
                      </li>
                    <% } %>
                  </ul>
                </div>
              <% } %>
              <!-- Pagination end -->

            <% } else if (data.search.results.aquabrowser.rowCount === 0) { %>
              <div class="campl-content-container">
                <p>Your search <% if (data.search.query.q) { %><strong><%= data.search.query.q %></strong> <% } %>did not match any of our resources.</p>
                <% if (data.search.results.aquabrowser.suggestions) { %>
                  <p>Did you mean
                    <% var i = 0; %>
                    <% for (suggestion in data.search.results.aquabrowser.suggestions.suggestedItems) { %><a href="/find-a-resource?<%= data.search.results.aquabrowser.suggestions.suggestedItems[suggestion].url %>"><%= data.search.results.aquabrowser.suggestions.suggestedItems[suggestion].label %></a><% if (i < data.search.results.aquabrowser.suggestions.suggestedItems.length - 1) { %>, <% } i++ %><% } %>?
                  </p>
                <% } %>
                <hr>
                <p><% if (data.search.results.aquabrowser.suggestions) { %>More <% } %>Suggestions:</p>
                <ul class="campl-unstyled-list">
                  <li>Check your spelling</li>
                  <li>Try different terms</li>
                  <li>Try more general terms</li>
                </ul>
              </div>
            <% } %>
          <% } else { %>
            <p>An error occurred while fetching books & journals</p>
          <% } %>
        </div>
        <!-- Resources end -->
      <% } else if (data.search.query.api === 'summon') { %>
        <!-- Summon start -->

        <!-- Facets overview start -->
        <% if (data.search.results.summon.facetsOverview.length) { %>
          <div class="campl-column12">
            <div class="campl-content-container">
              <p class="lg-active-facets">
                Refining by:
                <% for (facetIndex in data.search.results.summon.facetsOverview) { %>
                  <span class="lg-active-facet">
                    <%= data.search.results.summon.facetsOverview[facetIndex].label %>
                    <a href="?<%= data.search.results.summon.facetsOverview[facetIndex].url %>" title="Remove filter">(x)</a>
                  </span>
                <% }%>
              </p>
            </div>
          </div>
        <% } %>

        <!-- Facets start -->
        <% if (data.search.results.summon.rowCount > 0) { %>
          <div class="campl-column3">
            <div class="campl-tertiary-navigation lg-results-facets">
              <div id="summon-facets" class="campl-tertiary-navigation-structure">

                <!-- Loop start -->
                <% if (data.search.results.summon.facets) { %>
                  <% for (facetType in data.search.results.summon.facets) { %>
                    <% var facet = data.search.results.summon.facets[facetType]; %>
                    <ul class="campl-unstyled-list campl-vertical-breadcrumb">
                      <li>
                        <a href="#facet-summon-<%= facet.label %>" data-toggle="collapse" data-parent="#summon-facets"><%= facet.label %>
                          <span class="campl-vertical-breadcrumb-indicator"></span>
                        </a>
                      </li>
                    </ul>
                    <div id="facet-summon-<%= facet.label %>" class="in">
                      <ul class="campl-unstyled-list campl-vertical-breadcrumb-navigation">
                        <li class="campl-selected">
                          <ul class="campl-unstyled-list campl-vertical-breadcrumb-children">
                            <% for (facetValue in facet.facets) { %>
                              <li>
                                <a href="/find-a-resource?<%= facet.facets[facetValue].url %>">
                                  <%= facet.facets[facetValue].label %>
                                  (<%= facet.facets[facetValue].numItems %>)
                                </a>
                              </li>
                            <% } %>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  <% } %>
                <% } %>
                <!-- Loop end -->

              </div>
            </div>
          </div>
        <% } %>
        <!-- Facets end -->

        <!-- Resources start -->
        <div<% if (data.search.results.summon.rowCount > 0) { %> class="campl-column9"<% } %>>
          <% if (data.search.results.summon) { %>
            <% if (data.search.results.summon.rowCount > 0) { %>
              <% for (record in data.search.results.summon.items) { %>
                <article class="lg-search-result campl-listing-item campl-search-listing clearfix">
                  <div class="campl-column2">
                    <div class="lg-resource-img">
                      <% if (data.search.results.summon.items[record].thumbnail) { %>
                        <a href="/find-a-resource/summon/<%= data.search.results.summon.items[record].id[0] %>">
                          <img class="campl-scale-with-grid" src="<%= data.search.results.summon.items[record].thumbnail[0] %>" alt="<%= data.search.results.summon.items[record].title[0] %>">
                        </a>
                      <% } %>
                    </div>
                  </div>
                  <div class="campl-column10">
                    <div class="campl-content-container campl-listing-txt">
                      <header>
                        <h3 class="campl-listing-title">
                          <a href="/find-a-resource/summon/<%= data.search.results.summon.items[record].id[0] %>"><%= data.search.results.summon.items[record].title[0] %></a>
                        </h3>
                      </header>
                      <ul class="lg-resource-properties">
                        <% if (data.search.results.summon.items[record].author) { %>
                          <li>
                            <h4>Author(s)</h4>
                            <ul>
                              <% for (author in data.search.results.summon.items[record].author) { %>
                                <li><%= data.search.results.summon.items[record].author[author] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                        <% if (data.search.results.summon.items[record].date) { %>
                          <li>
                            <h4>Published</h4>
                            <ul>
                              <% for (date in data.search.results.summon.items[record].date) { %>
                                <li><%= data.search.results.summon.items[record].date[date] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                        <% if (data.search.results.summon.items[record].eisbn) { %>
                          <li>
                            <h4>EISBN</h4>
                            <ul>
                              <% for (eisbn in data.search.results.summon.items[record].eisbn) { %>
                                <li><%= data.search.results.summon.items[record].eisbn[eisbn] %></li>
                              <% } %>
                            </ul>
                          </li>
                        <% } %>
                      </ul>
                    </div>
                  </div>
                </article>
              <% } %>

              <!-- Pagination start -->
              <% if (data.search.results.summon.pagination.pageCount) { %>
                <div class="campl-pagination campl-pagination-centered">
                  <ul>
                    <% if (data.search.results.summon.pagination.previousPage.visible) { %>
                      <li class="campl-previous-li">
                        <a href="/find-a-resource?<%= data.search.results.summon.pagination.previousPage.url %>" class="ir campl-pagination-btn campl-previous"><span class="campl-arrow-span"></span>previous</a>
                      </li>
                    <% } %>
                    <% for (page in data.search.results.summon.pagination.pageRange) { %>

                      <% if (data.search.results.summon.pagination.pageRange[page].type === 'page') { %>
                        <li <% if (data.search.results.summon.pagination.pageRange[page].number === data.search.results.summon.pagination.pageNumber) { %>class="campl-active"<% } %>>
                          <a href="/find-a-resource?<%= data.search.results.summon.pagination.pageRange[page].url %>"><%= data.search.results.summon.pagination.pageRange[page].number %></a>
                        </li>
                      <% } else { %>
                        <li>
                          <span class="campl-elipsis">...</span>
                        </li>
                      <% } %>
                    <% } %>
                    <% if (data.search.results.summon.pagination.nextPage.visible) { %>
                      <li class="campl-next-li">
                        <a href="/find-a-resource?<%= data.search.results.summon.pagination.nextPage.url %>" class="ir campl-pagination-btn campl-next"><span class="campl-arrow-span"></span>next</a>
                      </li>
                    <% } %>
                  </ul>
                </div>
              <% } %>
              <!-- Pagination end -->

            <% } else if (data.search.results.summon.rowCount === 0) { %>
              <div class="campl-content-container">
                <p>Your search <% if (data.search.query.q) { %><strong><%= data.search.query.q %></strong> <% } %>did not match any of our resources.</p>
                <% if (data.search.results.summon.suggestions.suggestedItems.length) { %>
                  <p>Did you mean
                    <% var i = 0; %>
                    <% for (suggestion in data.search.results.summon.suggestions.suggestedItems) { %><a href="/find-a-resource?<%= data.search.results.summon.suggestions.suggestedItems[suggestion].url %>"><%= data.search.results.summon.suggestions.suggestedItems[suggestion].label %></a><% if (i < data.search.results.summon.suggestions.suggestedItems.length - 1) { %>, <% } i++ %><% } %>?
                  </p>
                <% } %>
                <hr>
                <p><% if (data.search.results.summon.suggestions.suggestedItems.length) { %>More <% } %>Suggestions:</p>
                <ul class="campl-unstyled-list">
                  <li>Check your spelling</li>
                  <li>Try different terms</li>
                  <li>Try more general terms</li>
                </ul>
              </div>
            <% } %>
          <% } else { %>
            <p>An error occurred while fetching articles</p>
          <% } %>
        </div>
        <!-- Resources end -->
        <!-- Summon end -->
      <% } %>

    </div>

    <div class="campl-column3 campl-secondary-content">
      <%- include ../partials/promo-researchskills.ejs %>
    </div>

  </div>
</div>
